# 第2回勉強会
### 大西涼衣
### 大橋芳樹
### 大木拓真
### 森井雄基
---

## 目次
* 更新情報
* Memo
* 注意事項
* 課題について
* ブラックジャックについて

---

## 更新情報
2018/11/19
* (Game.py) CPUアクションを実行する**cpuAction()** 関数のコメントが**プレイヤーアクション**となっていたので修正
* (Cpu.py) コメント内に記述されたスコアが17を超えるまで続けるアクションが**スタンド**となっていたので修正. **正しくはヒット**.
* (gameStart.py) 「**実行方法**」に記述の方法で実行した際に表示するメッセージの変更
* (Deck.py) **方法3**作成時の参考として**方法4**を追加
* (User.py) コンストラクタ内で定義される**変数のプライベート化**
* (User.py) 手札の合計値を取得する関数getSum()の仕様変更
    * **実行時に合計値の算出**を行えるように変更
* (User.py) バーストしているかどうかを返す関数isBurst()の仕様変更
    * **実行時に合計値を算出し,バーストしていればフラグを立てる**ように変更

2018/11/19  
README.mdの作成

2019/11/22　
提出期限を変更

2020/12/17　
提出期限を変更

2021/11/29　
提出期限を変更

---
## Memo
* **フローチャート**の作成を予定

---

## 注意事項
今回はこの資料を基にブラックジャックを作成するため,**実際のゲームとは少し異なる**  
例えば,各プレイヤーのアクションは後述する**ヒット**と**スタンド**のみであるが,実際はこれら以外にも存在する

---

## 課題について

### 期限
* **12月27日 (第3回勉強会実施日)**

### 内容
1. CPUの勝率が上昇するようにソースコードを編集
    * 初期での勝率: **平均約40% (試行回数: 100)**
    * 基準値となる勝率は設けていません
    * 必要に応じて**関数や変数の定義の追加,既存のソースコードの編集は問題ありません**
    * 裏側になっているディーラーのカードを読み取る等の**イカサマは認めません**
1. ソースコード内に記述されている設問への解答
    * 任意ではあるが,Pythonの扱い方がより学べるので**出来るだけ取り組んでください**

### 目的

* 他人が書いたソースコードを読んだり実際に実行してみることで,どのような処理がされているか理解する練習
* 他人が読む際に分かりやすいソースコードを書く練習
    * なぜそのような処理を行っているかについて分かりやすくコメントを記述
        * 以下の例のような自明すぎるコメントは不要
            ```Python 
            def plus(num1,num2):
                # 2つの引数を足し合わせた値を返す
                return num1 + num2
            ``` 
* ユーザーにとって使いやすいものを作る練習
* 思い描いた処理内容をソースコードに落とし込み,実現させる練習

### 準備
1. file-serverから圧縮ファイル(**question.zip**)を各自コピー
1. 圧縮ファイルを解凍し,カレントディレクトリを移動

### 実行方法
1. コマンドライン上にて下記を実行  
`python gameStart.py`

1. **標準出力にメッセージが表示**されるので確認してください

### 各ファイルについて
* gameStart.py
    * コマンドライン上にて**ゲームを開始する際に実行**
    * いわゆるmain関数が記述されたファイル
* Game.py
    * **ゲーム全体の流れ**の記述
* User.py
    * ディーラー,プレイヤー,CPUの**3つのクラスに継承されるUserクラス**の記述
* Deck.py
    * ディーラーが保持する**デッキを生成する関数**記述
* deck.csv
    * デッキ1組に含まれるカード52枚の**スート(記号)**と**数字**を記述
* Dealer.py
    * ゲームにおいて親の役割となる**Dealerクラス**の記述
* player.py
    * ゲームにおいて子の役割となる**Playerクラス**の記述
    * アクション選択は**標準入力を用いて手動で行う**
* Cpu.py
    * ゲームにおいて子の役割となる**Cpuクラス**の記述
    * Playerクラスとは異なり,アクション選択は**自動で行われる**
    * **今回の課題にて改良を行うファイル**

### Cpuクラス改良の際のアドバイス
* **最大ラウンド数の増加** (初期値: 100)
    * **デッキ個数の変更**もお忘れなく
* CPUとディーラーの**アクション実行間隔を0に変更**(初期値: 1)
* **プレイヤーの数を0にセット**
* Gameクラス内での**コンティニュー確認をコメントアウト**
* ラウンドごとに実行される**print()をコメントアウトし実行時間の短縮**
    * 例: UserクラスのshowHands()
    * Gameクラス内で宣言した**bool値を関数への引数として渡す方法**なら,**1つの変数の値変更で良くなる**ので各自好きな方法でどうぞ
        ```Python
            # 手札の公開
            def showHands(self):
                # 標準出力を行うかどうか格納
                visible = False

                # 文字から記号へのスート変換表
                charToSuit = {"H": "♡", "D": "♢", "C": "♧", "S": "♤"}

                self.sum = 0    # 合計値の初期化
                count = 0       # 所持しているエースの枚数

                if visible:
                    print("|",end="")
                for hand in self.hands:
                    # 表向き
                    if hand["show"]:
                        # カードの表示
                        if visible:
                            print(charToSuit[hand["suit"]] + " " + "{0:2d}".format(hand["number"]),end="|")

                        # 三項演算にて絵柄カードを10として扱う
                        value = 10 if hand["number"] >= 10 else hand["number"]

                        # エースの枚数カウント
                        if value == 1:
                            count += 1

                        self.sum += value
                    # 裏向き
                    else:
                        if visible:
                            print("■■■■",end="|")
        ```

---

## ブラックジャックについて
### 概要
* ジョーカーを除く**1デッキ52枚のトランプを複数**使用して行うゲーム
* ディーラー(親) vs プレイヤー(子)の対決
    * プレイヤーが複数人参加していても,**親 vs 子の構図に変化はない**
* ディーラーから配布される手札の数字の合計値を**スコア**として扱う
    * スコア算出における特殊性は「**絵柄カードとAの扱いについて**」にて解説

### 勝敗判定について
* バースト
    * スコアが**21を超えると敗北**
* ブラックジャック
    * スコアが**21ちょうどになると勝利**
* その他
    * スコアが**21に近い方の勝利**
    * スコアが同じ場合は**引き分け**

### 絵柄カードとAの扱いについて

スコア計算の際,各カードは以下の表を基に加算される

|A|2|3|4|5|6|7|8|9|10|J|Q|K|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|1 or 11|2|3|4|5|6|7|8|9|10|10|10|10|

* Aは**21を超えないように**11として扱うこともできる
    * 例1: 手札の数字が「3」「A」 → スコア: 14 (= 3 + **11**)
    * 例2: 手札の数字が「3」「10」「A」 → スコア: 14 (= 3 + 10 + **1**)
        * 11として扱うと24となり,**21を超えてしまうので1として計算**
    * 例3: 手札の数字が「3」「5」「A」「A」 → スコア: 20 (= 3 + 5 + **11** + **1**)
        * 1枚目は11として扱うが,2枚目を11として扱うと30となり**21を超えてしまうので2枚目は1として計算**


### ゲームの流れについて
1. (初期配布)
    * ディーラーを含む**すべてのプレイヤーにカードを2枚ずつ配布**
        * **ディーラーのカード1枚以外はすべて公開された状態**で配布される
1. (プレイヤーアクション)
    * 子が1人ずついずれかの行動を選択
        * **ヒット**: カードを1枚追加
        * **スタンド**: 行動終了宣言
1. (ディーラーアクション)
    * 初期配布の時点で**裏側になっていたカードを公開**
    * スコアが**17以上となるまでヒット**を続ける
    * スコアが**17以上になった時点でスタンド**
1. (勝敗判定)
    * 前述の「**勝敗判定について**」を参照
    * 勝敗判定はディーラーと各プレイヤーについて**それぞれ行われる**
        * 同じ手札であってもプレイヤーの手札によりディーラーが**勝利する場合や敗北する場合引き分ける場合がそれぞれ存在**

1 ~ 4までを**1ラウンド**とし,複数回試行する